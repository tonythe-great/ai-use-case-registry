<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Intake Form - {{ intake.system_name or 'New Assessment' }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .form-section {
            scroll-margin-top: 100px;
        }
        select, input, textarea {
            font-size: 16px; /* Prevents zoom on mobile */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">AI System Intake Form</h1>
                        <p class="text-sm text-gray-500">Enterprise Governance Assessment</p>
                    </div>
                </div>
                <a href="/intake" class="text-sm text-blue-600 hover:text-blue-800">‚Üê Back to Dashboard</a>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="bg-white border-b">
        <div class="max-w-4xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between text-sm">
                <span class="text-gray-500">Complete all required fields</span>
                <span class="text-blue-600 font-medium">Auto-saves as you type</span>
            </div>
        </div>
    </div>

    <main class="max-w-4xl mx-auto px-4 py-8">
        <form id="intake-form" method="POST" action="/api/intakes/{{ intake.id }}" class="space-y-8">

            <!-- Section 1: Basic Information -->
            <section class="form-section bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-blue-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <span class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center mr-3 text-sm">1</span>
                        Basic Information
                    </h2>
                    <p class="text-blue-100 text-sm mt-1">Tell us about the AI system you're assessing</p>
                </div>
                <div class="p-6 space-y-5">
                    <!-- System Name -->
                    <div>
                        <label for="system_name" class="block text-sm font-medium text-gray-700 mb-2">
                            AI System Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="system_name" name="system_name"
                               value="{{ intake.system_name or '' }}"
                               placeholder="e.g., ChatGPT Enterprise, Microsoft Copilot"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               required>
                    </div>

                    <!-- Business Purpose -->
                    <div>
                        <label for="business_purpose" class="block text-sm font-medium text-gray-700 mb-2">
                            What will this AI be used for? <span class="text-red-500">*</span>
                        </label>
                        <select id="business_purpose_select"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-2">
                            <option value="">Select a common use case...</option>
                            <option value="Information gathering, research, and decision support">Research & Decision Support</option>
                            <option value="Content creation and editing (documents, emails, presentations)">Content Creation</option>
                            <option value="Customer service and support automation">Customer Service</option>
                            <option value="Data analysis and reporting">Data Analysis</option>
                            <option value="Software development and code assistance">Software Development</option>
                            <option value="Process automation and workflow optimization">Process Automation</option>
                            <option value="Training and employee education">Training & Education</option>
                            <option value="custom">Other (describe below)</option>
                        </select>
                        <textarea id="business_purpose" name="business_purpose" rows="2"
                                  placeholder="Describe the specific business purpose..."
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ intake.business_purpose or '' }}</textarea>
                    </div>

                    <!-- Vendor -->
                    <div>
                        <label for="vendor_name" class="block text-sm font-medium text-gray-700 mb-2">
                            AI Provider / Vendor <span class="text-red-500">*</span>
                        </label>
                        <select id="vendor_name" name="vendor_name"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                required>
                            <option value="">Select vendor...</option>
                            <optgroup label="Major AI Providers">
                                <option value="OpenAI" {% if intake.vendor_name == 'OpenAI' %}selected{% endif %}>OpenAI (ChatGPT, GPT-4)</option>
                                <option value="Microsoft" {% if intake.vendor_name == 'Microsoft' %}selected{% endif %}>Microsoft (Copilot, Azure OpenAI)</option>
                                <option value="Google" {% if intake.vendor_name == 'Google' %}selected{% endif %}>Google (Gemini, Vertex AI)</option>
                                <option value="Anthropic" {% if intake.vendor_name == 'Anthropic' %}selected{% endif %}>Anthropic (Claude)</option>
                                <option value="Amazon" {% if intake.vendor_name == 'Amazon' %}selected{% endif %}>Amazon (Bedrock, Q)</option>
                            </optgroup>
                            <optgroup label="Enterprise Platforms">
                                <option value="Salesforce" {% if intake.vendor_name == 'Salesforce' %}selected{% endif %}>Salesforce (Einstein)</option>
                                <option value="ServiceNow" {% if intake.vendor_name == 'ServiceNow' %}selected{% endif %}>ServiceNow</option>
                                <option value="SAP" {% if intake.vendor_name == 'SAP' %}selected{% endif %}>SAP</option>
                                <option value="IBM" {% if intake.vendor_name == 'IBM' %}selected{% endif %}>IBM (Watson)</option>
                            </optgroup>
                            <optgroup label="Other">
                                <option value="In-house" {% if intake.vendor_name == 'In-house' %}selected{% endif %}>In-house / Custom Built</option>
                                <option value="Other" {% if intake.vendor_name == 'Other' %}selected{% endif %}>Other</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- Deployment Status -->
                    <div>
                        <label for="deployment_status" class="block text-sm font-medium text-gray-700 mb-2">
                            Current Stage <span class="text-red-500">*</span>
                        </label>
                        <select id="deployment_status" name="deployment_status"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                required>
                            <option value="">Select current stage...</option>
                            <option value="planning" {% if intake.deployment_status == 'planning' %}selected{% endif %}>Planning - Not yet deployed</option>
                            <option value="pilot" {% if intake.deployment_status == 'pilot' %}selected{% endif %}>Pilot - Testing with limited users</option>
                            <option value="limited_production" {% if intake.deployment_status == 'limited_production' %}selected{% endif %}>Limited Production - Specific teams only</option>
                            <option value="full_production" {% if intake.deployment_status == 'full_production' %}selected{% endif %}>Full Production - Organization-wide</option>
                            <option value="deprecated" {% if intake.deployment_status == 'deprecated' %}selected{% endif %}>Deprecated - Being phased out</option>
                        </select>
                    </div>

                    <!-- User Count -->
                    <div>
                        <label for="user_count" class="block text-sm font-medium text-gray-700 mb-2">
                            Number of Users
                        </label>
                        <select id="user_count_range"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select user count range...</option>
                            <option value="10">1-10 users</option>
                            <option value="50">11-50 users</option>
                            <option value="100">51-100 users</option>
                            <option value="500">101-500 users</option>
                            <option value="1000">500+ users</option>
                        </select>
                        <input type="hidden" id="user_count" name="user_count" value="{{ intake.user_count or '' }}">
                    </div>
                </div>
            </section>

            <!-- Section 2: Human Oversight -->
            <section class="form-section bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-purple-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <span class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center mr-3 text-sm">2</span>
                        Human Oversight
                    </h2>
                    <p class="text-purple-100 text-sm mt-1">How will humans be involved in AI decisions?</p>
                </div>
                <div class="p-6 space-y-5">
                    <!-- Decision Classification -->
                    <div>
                        <label for="decision_classification" class="block text-sm font-medium text-gray-700 mb-2">
                            How will AI outputs be used? <span class="text-red-500">*</span>
                        </label>
                        <select id="decision_classification" name="decision_classification"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                required>
                            <option value="">Select how outputs will be used...</option>
                            <option value="informational" {% if intake.decision_classification == 'informational' %}selected{% endif %}>Information Only - Humans make all decisions</option>
                            <option value="decision_support" {% if intake.decision_classification == 'decision_support' %}selected{% endif %}>Decision Support - AI recommends, humans decide</option>
                            <option value="semi_autonomous" {% if intake.decision_classification == 'semi_autonomous' %}selected{% endif %}>Semi-Autonomous - AI acts with human oversight</option>
                            <option value="fully_autonomous" {% if intake.decision_classification == 'fully_autonomous' %}selected{% endif %}>Fully Autonomous - AI operates independently</option>
                        </select>
                    </div>

                    <!-- Human in the Loop -->
                    <div>
                        <label for="human_in_the_loop" class="block text-sm font-medium text-gray-700 mb-2">
                            Level of Human Review <span class="text-red-500">*</span>
                        </label>
                        <select id="human_in_the_loop" name="human_in_the_loop"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                required>
                            <option value="">Select level of human review...</option>
                            <option value="full_oversight" {% if intake.human_in_the_loop == 'full_oversight' %}selected{% endif %}>Full Oversight - Human reviews every output</option>
                            <option value="approval_required" {% if intake.human_in_the_loop == 'approval_required' %}selected{% endif %}>Approval Required - Human approves important decisions</option>
                            <option value="exception_only" {% if intake.human_in_the_loop == 'exception_only' %}selected{% endif %}>Exception Only - Human reviews flagged items</option>
                            <option value="none" {% if intake.human_in_the_loop == 'none' %}selected{% endif %}>No Review - AI outputs used directly</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Section 3: Data & Privacy -->
            <section class="form-section bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-emerald-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <span class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center mr-3 text-sm">3</span>
                        Data & Privacy
                    </h2>
                    <p class="text-emerald-100 text-sm mt-1">What data will be used with this AI?</p>
                </div>
                <div class="p-6 space-y-5">
                    <!-- Approved Data Types -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            What types of data will be used? <span class="text-red-500">*</span>
                        </label>
                        <p class="text-sm text-gray-500 mb-3">Select all that apply</p>
                        {% set approved_data = intake.approved_data_types or [] %}
                        <div class="grid grid-cols-2 gap-2">
                            {% set data_options = [
                                ('Public Information', 'green'),
                                ('Internal Documents', 'green'),
                                ('Business Strategy', 'yellow'),
                                ('Employee Data', 'yellow'),
                                ('Customer Data', 'orange'),
                                ('Financial Data', 'orange'),
                                ('Personal Information (PII)', 'red'),
                                ('Health Data', 'red')
                            ] %}
                            {% for dtype, risk in data_options %}
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50
                                         {% if dtype in approved_data %}border-{{ risk }}-500 bg-{{ risk }}-50{% else %}border-gray-200{% endif %}">
                                <input type="checkbox" name="approved_data_types[]" value="{{ dtype }}"
                                       {% if dtype in approved_data %}checked{% endif %}
                                       class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-3 text-sm text-gray-700">{{ dtype }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Data Retention -->
                    <div>
                        <label for="data_retention_policy" class="block text-sm font-medium text-gray-700 mb-2">
                            Does the vendor store your data?
                        </label>
                        <select id="data_retention_policy" name="data_retention_policy"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select data retention policy...</option>
                            <option value="zero_retention" {% if intake.data_retention_policy == 'zero_retention' %}selected{% endif %}>No Retention - Data deleted immediately</option>
                            <option value="30_days" {% if intake.data_retention_policy == '30_days' %}selected{% endif %}>30 Days</option>
                            <option value="90_days" {% if intake.data_retention_policy == '90_days' %}selected{% endif %}>90 Days</option>
                            <option value="1_year" {% if intake.data_retention_policy == '1_year' %}selected{% endif %}>1 Year</option>
                            <option value="indefinite" {% if intake.data_retention_policy == 'indefinite' %}selected{% endif %}>Indefinite / Unknown</option>
                        </select>
                    </div>

                    <!-- User Training -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            User Training & Awareness
                        </label>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50
                                         {% if intake.user_awareness_training %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                                <input type="checkbox" name="user_awareness_training" value="true"
                                       {% if intake.user_awareness_training %}checked{% endif %}
                                       class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-3 text-sm text-gray-700">Users will receive training on proper use</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50
                                         {% if intake.user_awareness_attestation %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                                <input type="checkbox" name="user_awareness_attestation" value="true"
                                       {% if intake.user_awareness_attestation %}checked{% endif %}
                                       class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-3 text-sm text-gray-700">Users must sign an acceptable use agreement</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 4: Ownership -->
            <section class="form-section bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-orange-500 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <span class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center mr-3 text-sm">4</span>
                        Ownership & Accountability
                    </h2>
                    <p class="text-orange-100 text-sm mt-1">Who is responsible for this AI system?</p>
                </div>
                <div class="p-6 space-y-5">
                    <!-- Approving Authority -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <label class="block text-sm font-medium text-blue-800 mb-3">
                            Executive Sponsor / Approving Authority <span class="text-red-500">*</span>
                        </label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" name="approving_authority"
                                   value="{{ intake.approving_authority or '' }}"
                                   placeholder="Full Name"
                                   class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   required>
                            <input type="text" name="approving_authority_title"
                                   value="{{ intake.approving_authority_title or '' }}"
                                   placeholder="Title (e.g., CTO, VP Engineering)"
                                   class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- Business Owner -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Business Owner
                        </label>
                        <p class="text-sm text-gray-500 mb-2">Person responsible for business outcomes</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" name="business_owner"
                                   value="{{ intake.business_owner or '' }}"
                                   placeholder="Full Name"
                                   class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <input type="email" name="business_owner_email"
                                   value="{{ intake.business_owner_email or '' }}"
                                   placeholder="Email"
                                   class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- Technical Owner -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Technical Owner
                        </label>
                        <p class="text-sm text-gray-500 mb-2">Person responsible for technical implementation</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" name="technical_owner"
                                   value="{{ intake.technical_owner or '' }}"
                                   placeholder="Full Name"
                                   class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <input type="email" name="technical_owner_email"
                                   value="{{ intake.technical_owner_email or '' }}"
                                   placeholder="Email"
                                   class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Compliance & Monitoring -->
            <section class="form-section bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-slate-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <span class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center mr-3 text-sm">5</span>
                        Compliance & Monitoring
                    </h2>
                    <p class="text-slate-200 text-sm mt-1">How will usage be tracked and monitored?</p>
                </div>
                <div class="p-6 space-y-5">
                    <!-- Federal Contracts -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Does your organization hold federal contracts?
                        </label>
                        <select id="federal_contracts" name="federal_contracts"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select...</option>
                            <option value="true" {% if intake.federal_contracts %}selected{% endif %}>Yes</option>
                            <option value="false" {% if intake.federal_contracts == false %}selected{% endif %}>No</option>
                            <option value="unknown">I don't know</option>
                        </select>
                    </div>

                    <!-- Logging -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Monitoring & Logging
                        </label>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50
                                         {% if intake.usage_logging_enabled %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                                <input type="checkbox" name="usage_logging_enabled" value="true"
                                       {% if intake.usage_logging_enabled %}checked{% endif %}
                                       class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-3 text-sm text-gray-700">Usage logging is enabled</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50
                                         {% if intake.compliance_visibility %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                                <input type="checkbox" name="compliance_visibility" value="true"
                                       {% if intake.compliance_visibility %}checked{% endif %}
                                       class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-3 text-sm text-gray-700">Compliance team has access to monitoring</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50
                                         {% if intake.incident_response_documented %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                                <input type="checkbox" name="incident_response_documented" value="true"
                                       {% if intake.incident_response_documented %}checked{% endif %}
                                       class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-3 text-sm text-gray-700">Incident response process is documented</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Submit Section -->
            <section class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-gray-900">Ready to submit?</h3>
                            <p class="text-sm text-gray-500">Your assessment will be reviewed by the governance team</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <a href="/intake" class="px-6 py-3 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 font-medium">
                                Save Draft
                            </a>
                            <button type="submit" class="px-6 py-3 text-white bg-blue-600 rounded-lg hover:bg-blue-700 font-medium">
                                Submit for Review
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </form>
    </main>

    <!-- Footer -->
    <footer class="border-t bg-white mt-12">
        <div class="max-w-4xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
            <p>Enterprise AI Governance System</p>
            <p class="mt-1">Framework: NIST AI Risk Management Framework (AI RMF)</p>
        </div>
    </footer>

    <script>
        // Auto-populate business purpose from dropdown
        document.getElementById('business_purpose_select').addEventListener('change', function() {
            const textarea = document.getElementById('business_purpose');
            if (this.value && this.value !== 'custom') {
                textarea.value = this.value;
            }
        });

        // Auto-populate user count from range
        document.getElementById('user_count_range').addEventListener('change', function() {
            document.getElementById('user_count').value = this.value;
        });

        // Set initial user count range based on existing value
        const userCount = {{ intake.user_count or 0 }};
        const rangeSelect = document.getElementById('user_count_range');
        if (userCount > 0) {
            if (userCount <= 10) rangeSelect.value = '10';
            else if (userCount <= 50) rangeSelect.value = '50';
            else if (userCount <= 100) rangeSelect.value = '100';
            else if (userCount <= 500) rangeSelect.value = '500';
            else rangeSelect.value = '1000';
        }
    </script>
</body>
</html>
