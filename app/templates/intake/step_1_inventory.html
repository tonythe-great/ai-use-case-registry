{% extends "intake/_wizard_layout.html" %}

{% block title %}Step 1: AI System Inventory - AI Governance Intake{% endblock %}

{% block step_title %}AI System Inventory{% endblock %}
{% block step_description %}Basic information about the AI system being assessed.{% endblock %}

{% block form_content %}
<div class="space-y-6">
    <!-- System Name -->
    <div>
        <label for="system_name" class="block text-sm font-medium text-gray-700 mb-1">
            AI System Name <span class="text-red-500">*</span>
        </label>
        <input type="text"
               id="system_name"
               name="system_name"
               value="{{ intake.system_name or '' }}"
               placeholder="e.g., ChatGPT Enterprise, Copilot, Internal ML Model"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <p class="mt-1 text-sm text-gray-500">The name used to identify this AI system internally.</p>
    </div>

    <!-- Business Purpose -->
    <div>
        <label for="business_purpose" class="block text-sm font-medium text-gray-700 mb-1">
            Business Purpose <span class="text-red-500">*</span>
        </label>
        <textarea id="business_purpose"
                  name="business_purpose"
                  rows="3"
                  placeholder="Describe what business problem this AI system solves..."
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ intake.business_purpose or '' }}</textarea>
        <p class="mt-1 text-sm text-gray-500">What business need does this system address?</p>
    </div>

    <!-- Build vs Buy -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Build vs. Buy
        </label>
        <div class="grid grid-cols-3 gap-3">
            {% set build_options = [
                ('build', 'Build', 'Developed in-house'),
                ('buy', 'Buy', 'Purchased/licensed vendor solution'),
                ('hybrid', 'Hybrid', 'Mix of custom and vendor components')
            ] %}
            {% for value, label, desc in build_options %}
            <label class="relative flex flex-col p-4 border rounded-lg cursor-pointer hover:border-blue-500 transition-colors
                         {% if intake.build_vs_buy == value %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                <input type="radio"
                       name="build_vs_buy"
                       value="{{ value }}"
                       {% if intake.build_vs_buy == value %}checked{% endif %}
                       class="sr-only">
                <span class="font-medium text-gray-900">{{ label }}</span>
                <span class="text-sm text-gray-500">{{ desc }}</span>
                <div class="absolute top-2 right-2 w-4 h-4 rounded-full border-2
                           {% if intake.build_vs_buy == value %}border-blue-500 bg-blue-500{% else %}border-gray-300{% endif %}">
                    {% if intake.build_vs_buy == value %}
                    <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                    {% endif %}
                </div>
            </label>
            {% endfor %}
        </div>
    </div>

    <!-- Vendor Name (conditional) -->
    <div id="vendor-section" class="{% if intake.build_vs_buy == 'build' %}hidden{% endif %}">
        <label for="vendor_name" class="block text-sm font-medium text-gray-700 mb-1">
            Vendor Name
        </label>
        <select id="vendor_name"
                name="vendor_name"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">Select vendor...</option>
            {% set vendors = [
                'OpenAI', 'Microsoft (Azure OpenAI)', 'Google (Vertex AI/Gemini)', 'Anthropic',
                'Amazon (Bedrock)', 'IBM Watson', 'Salesforce Einstein', 'SAP',
                'ServiceNow', 'Workday', 'UiPath', 'Automation Anywhere',
                'DataRobot', 'H2O.ai', 'Databricks', 'Snowflake', 'Other'
            ] %}
            {% for vendor in vendors %}
            <option value="{{ vendor }}" {% if intake.vendor_name == vendor %}selected{% endif %}>{{ vendor }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Deployment Status -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Deployment Status
        </label>
        <div class="space-y-2">
            {% set deployment_options = [
                ('planning', 'Planning', 'Not yet deployed, still in planning phase'),
                ('pilot', 'Pilot', 'Limited deployment for testing with select users'),
                ('limited_production', 'Limited Production', 'Deployed to specific teams or use cases'),
                ('full_production', 'Full Production', 'Widely deployed across the organization'),
                ('deprecated', 'Deprecated', 'Being phased out or replaced')
            ] %}
            {% for value, label, desc in deployment_options %}
            <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:border-blue-500 transition-colors
                         {% if intake.deployment_status == value %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                <input type="radio"
                       name="deployment_status"
                       value="{{ value }}"
                       {% if intake.deployment_status == value %}checked{% endif %}
                       class="mt-0.5 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                <div class="ml-3">
                    <span class="font-medium text-gray-900">{{ label }}</span>
                    <p class="text-sm text-gray-500">{{ desc }}</p>
                </div>
            </label>
            {% endfor %}
        </div>
    </div>

    <!-- User Count -->
    <div>
        <label for="user_count" class="block text-sm font-medium text-gray-700 mb-1">
            Estimated Number of Users
        </label>
        <input type="number"
               id="user_count"
               name="user_count"
               value="{{ intake.user_count or '' }}"
               min="0"
               placeholder="e.g., 50"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <p class="mt-1 text-sm text-gray-500">How many people will use this AI system?</p>
    </div>

    <!-- Human in the Loop -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Human Oversight Level
        </label>
        <p class="text-sm text-gray-500 mb-3">How much human review is involved in AI outputs?</p>
        <div class="space-y-2">
            {% set oversight_options = [
                ('full_oversight', 'Full Oversight', 'Human reviews every AI output before use', 'bg-green-100 text-green-800'),
                ('approval_required', 'Approval Required', 'Human approval needed for significant decisions', 'bg-blue-100 text-blue-800'),
                ('exception_only', 'Exception-Based', 'Human review only for flagged items or exceptions', 'bg-yellow-100 text-yellow-800'),
                ('none', 'No Human Review', 'AI outputs used directly without human review', 'bg-red-100 text-red-800')
            ] %}
            {% for value, label, desc, badge_class in oversight_options %}
            <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:border-blue-500 transition-colors
                         {% if intake.human_in_the_loop == value %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                <input type="radio"
                       name="human_in_the_loop"
                       value="{{ value }}"
                       {% if intake.human_in_the_loop == value %}checked{% endif %}
                       class="mt-0.5 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                <div class="ml-3 flex-1">
                    <div class="flex items-center space-x-2">
                        <span class="font-medium text-gray-900">{{ label }}</span>
                        <span class="px-2 py-0.5 text-xs font-medium rounded-full {{ badge_class }}">
                            {% if value == 'full_oversight' %}Low Risk{% elif value == 'approval_required' %}Moderate{% elif value == 'exception_only' %}Higher Risk{% else %}Highest Risk{% endif %}
                        </span>
                    </div>
                    <p class="text-sm text-gray-500">{{ desc }}</p>
                </div>
            </label>
            {% endfor %}
        </div>
    </div>

    <!-- Integration Points -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
            System Integrations
        </label>
        <p class="text-sm text-gray-500 mb-3">Select all systems this AI connects to:</p>
        <div class="grid grid-cols-2 gap-2">
            {% set integration_options = [
                'Email Systems', 'CRM (Salesforce, etc.)', 'ERP Systems', 'HR Systems',
                'Document Management', 'Source Code Repos', 'Databases', 'Cloud Storage',
                'Customer Portals', 'Internal Chat/Teams', 'Analytics Platforms', 'Other'
            ] %}
            {% set current_integrations = intake.integration_points or [] %}
            {% for integration in integration_options %}
            <label class="flex items-center p-2 border rounded-lg cursor-pointer hover:border-blue-500 transition-colors
                         {% if integration in current_integrations %}border-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}">
                <input type="checkbox"
                       name="integration_points[]"
                       value="{{ integration }}"
                       {% if integration in current_integrations %}checked{% endif %}
                       class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <span class="ml-2 text-sm text-gray-700">{{ integration }}</span>
            </label>
            {% endfor %}
        </div>
    </div>

    <!-- Technical Constraints -->
    <div>
        <label for="technical_constraints" class="block text-sm font-medium text-gray-700 mb-1">
            Technical Constraints or Limitations
        </label>
        <textarea id="technical_constraints"
                  name="technical_constraints"
                  rows="2"
                  placeholder="Any known technical limitations, dependencies, or constraints..."
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ intake.technical_constraints or '' }}</textarea>
        <p class="mt-1 text-sm text-gray-500">Optional: Note any technical requirements or limitations.</p>
    </div>
</div>

<script>
// Show/hide vendor field based on build vs buy selection
document.querySelectorAll('input[name="build_vs_buy"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const vendorSection = document.getElementById('vendor-section');
        if (this.value === 'build') {
            vendorSection.classList.add('hidden');
        } else {
            vendorSection.classList.remove('hidden');
        }
    });
});
</script>
{% endblock %}
